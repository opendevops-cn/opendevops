(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{395:function(t,s,a){"use strict";a.r(s);var n=a(46),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"如何使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何使用"}},[t._v("#")]),t._v(" 如何使用")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#任务模版"}},[t._v("任务模版")])]),a("li",[a("a",{attrs:{href:"#任务发布"}},[t._v("任务发布")])]),a("li",[a("a",{attrs:{href:"#定时任务"}},[t._v("定时任务")])]),a("li",[a("a",{attrs:{href:"#代码仓库"}},[t._v("代码仓库")])]),a("li",[a("a",{attrs:{href:"#监控告警"}},[t._v("监控告警")])]),a("li",[a("a",{attrs:{href:"#资产管理"}},[t._v("资产管理")])]),a("li",[a("a",{attrs:{href:"#配置中心"}},[t._v("配置中心")])]),a("li",[a("a",{attrs:{href:"#用户管理"}},[t._v("用户管理")])]),a("li",[a("a",{attrs:{href:"#系统管理"}},[t._v("系统管理")])])])]),a("p"),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("这部分主要是使用文档")])]),t._v(" "),a("h2",{attrs:{id:"任务模版"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#任务模版"}},[t._v("#")]),t._v(" 任务模版")]),t._v(" "),a("blockquote",[a("p",[t._v("这部分文档主要用来介绍任务模板，任务模板：可以帮助你实现一个很强大、很复杂、可干预、自定义的任务流程模板；"),a("br"),t._v("\n任务模板功能主要分为：命令管理、模板管理、参数管理、执行用户等部分，由于这块稍微有点难理解，我们提供了"),a("a",{attrs:{href:"https://docs.opendevops.cn/zh/guide/more/example/",target:"_blank",rel:"noopener noreferrer"}},[t._v("示例文档"),a("OutboundLink")],1),t._v("和"),a("a",{attrs:{href:"https://www.bilibili.com/video/av53424572/",target:"_blank",rel:"noopener noreferrer"}},[t._v("视频演示"),a("OutboundLink")],1)])]),t._v(" "),a("p",[a("strong",[t._v("命令管理")])]),t._v(" "),a("blockquote",[a("p",[t._v("主要用于创建你的自定义命令，后续供平台执行使用")])]),t._v(" "),a("p",[a("strong",[t._v("功能特点")])]),t._v(" "),a("ul",[a("li",[t._v("支持"),a("code",[t._v("Linux Bash")]),t._v("命令")]),t._v(" "),a("li",[t._v("支持自定义脚本命令(不限语言)")]),t._v(" "),a("li",[t._v("全局命令统一管理、详细记录展示")]),t._v(" "),a("li",[t._v("命令可视化编辑、搜索、新增、删除等操作")])]),t._v(" "),a("p",[a("strong",[t._v("如何使用")])]),t._v(" "),a("p",[t._v("点开"),a("code",[t._v("任务模板")]),t._v("->"),a("code",[t._v("命令管理")])]),t._v(" "),a("ul",[a("li",[t._v("新建命令\n"),a("ul",[a("li",[t._v("命令名称：输入你的名称(建议是有意义的名字，后续方便你勾选使用)")]),t._v(" "),a("li",[t._v("执行命令：可以是"),a("code",[t._v("Linux Bash")]),t._v("命令，如："),a("code",[t._v("ls,free -m")]),t._v("，也可以是一个执行脚本，如："),a("code",[t._v("python3 xxx.py")])]),t._v(" "),a("li",[t._v("命令参数：这里一般用于执行脚本传入参数，如："),a("code",[t._v("pytho3 xxx.py --host=127.0.0.1")]),t._v("，这里就可以填入自身参数："),a("code",[t._v("--host=127.0.0.1")]),t._v(", 可留空，也可后续使用到修改")]),t._v(" "),a("li",[t._v("强制主机：默认可为空，用于你所填写的命令强制指定哪个主机上进行执行（注意：你所指定的这台机器IP，此平台必须可以登陆过去，否则无法执行，CODO平台如何登陆所指定的主机IP请参考"),a("code",[t._v("执行用户")]),t._v("文档）")])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"/create_bash.png",alt:""}})]),t._v(" "),a("p",[t._v("示例图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/bash_list.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("模板管理")])]),t._v(" "),a("blockquote",[a("p",[t._v("模板管理是一个核心功能，这里逻辑稍有复杂、但功能极为强大，这里主要用于自定义你的任务流程。")])]),t._v(" "),a("p",[a("strong",[t._v("功能特点")])]),t._v(" "),a("ul",[a("li",[t._v("支持自定义模板流程")]),t._v(" "),a("li",[t._v("支持多组多优先级并发执行")]),t._v(" "),a("li",[t._v("自定义流程可人工干预、可定时执行")]),t._v(" "),a("li",[t._v("模板可搜索、可编辑、可删除、模板权限细分等")])]),t._v(" "),a("p",[a("strong",[t._v("如何使用")])]),t._v(" "),a("p",[t._v("点开"),a("code",[t._v("任务模板")]),t._v("->"),a("code",[t._v("模板管理")])]),t._v(" "),a("ul",[a("li",[t._v("创建模板\n"),a("ul",[a("li",[t._v("模板名称： 建议输入一个有意义的名称，注意："),a("code",[t._v("此名称不可更改")])])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"/template_create.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("如何对模板赋权")])]),t._v(" "),a("blockquote",[a("p",[t._v("模板赋权是☞哪些用户可以对此模板有权限（编辑、删除、修改等），管理员默认拥有所有权限。")])]),t._v(" "),a("p",[t._v("点开点开"),a("code",[t._v("任务模板")]),t._v("->"),a("code",[t._v("模板管理")]),t._v("->"),a("code",[t._v("授权")]),t._v("-"),a("code",[t._v("选择关联的用户")])]),t._v(" "),a("p",[a("strong",[t._v("自定义你的模板流程")])]),t._v(" "),a("p",[t._v("首先我们已经创建了一个新的模板，接下来我们向模板里面添加一些自定义的内容")]),t._v(" "),a("ul",[a("li",[t._v("1、选中你的模板")]),t._v(" "),a("li",[t._v("2、下拉选择你的命令进行提交（支持同时选择多个哦~）")]),t._v(" "),a("li",[t._v("3、修改模板流程中的字段信息")]),t._v(" "),a("li",[t._v("4、最后记得保存编辑")])]),t._v(" "),a("p",[t._v("示例：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/select_bash.png",alt:""}})]),t._v(" "),a("p",[t._v("下图字段说明：")]),t._v(" "),a("ul",[a("li",[t._v("组：默认为：88， 请修改为：1， 默认从第一组开始执行（多组配置示例见下图）")]),t._v(" "),a("li",[t._v("优先级： 执行命令的优先级，修改对应数字即可")]),t._v(" "),a("li",[t._v("任务名称： 此任务名称是你"),a("code",[t._v("命令管理")]),t._v("命令名称，自动带出")]),t._v(" "),a("li",[t._v("执行命令： 此执行命令是你"),a("code",[t._v("命令管理")]),t._v("执行命令，自动带出")]),t._v(" "),a("li",[t._v("参数：此参数是你"),a("code",[t._v("命令管理")]),t._v("参数，自动带出，"),a("code",[t._v("参数例如：--host=127.0.0.1 --group=game01")]),t._v("空格隔离第二个参数")]),t._v(" "),a("li",[t._v("执行用户： 此执行用户用于登陆你的执行主机，从"),a("code",[t._v("任务模板->执行用户")]),t._v("里面选择，详细见"),a("code",[t._v("执行用户")]),t._v("部分使用说明")]),t._v(" "),a("li",[t._v("触发器：可选默认（默认直接执行）、定时（到达时间后开始执行，此时间是提交任务的时候指定的时间）、干预（需要手动触发执行）")]),t._v(" "),a("li",[t._v("指定主机：指定那台主机执行此命令，IP地址形式，"),a("code",[t._v("CODO平台需要能登陆此主机")])]),t._v(" "),a("li",[t._v("删除： 删除所选项")])]),t._v(" "),a("p",[t._v("单组配置示例：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/template_edit.png",alt:""}})]),t._v(" "),a("p",[t._v("多组配置示例：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/s_group_template.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("参数管理")])]),t._v(" "),a("blockquote",[a("p",[t._v("参数名称类似于别名的概念，订单显示时参数值会被参数名称替代")])]),t._v(" "),a("p",[t._v("多组配置示例：")]),t._v(" "),a("p",[t._v("​                        "),a("img",{attrs:{src:"/parameter.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("执行用户")])]),t._v(" "),a("blockquote",[a("p",[t._v("执行用户：主要用于登陆命令管理/模板管理里面指定的主机的验证，任务一般都是通过SSH进行远程执行、编排模板的时候需要选择一个用户进行登陆主机")])]),t._v(" "),a("p",[a("strong",[t._v("如何使用")]),t._v("\n点开"),a("code",[t._v("任务模板")]),t._v("->"),a("code",[t._v("执行用户")])]),t._v(" "),a("ul",[a("li",[t._v("新建用户\n"),a("ul",[a("li",[t._v("用户名称：如："),a("code",[t._v("root, ops")]),t._v("此系统用户，注意："),a("code",[t._v("此用户是Linux系统用户哦~")])]),t._v(" "),a("li",[t._v("SSH端口：你的SSH端口，如："),a("code",[t._v("22")])]),t._v(" "),a("li",[t._v("备注：描述用途使用")]),t._v(" "),a("li",[t._v("用户私钥：服务器机器的私钥，一般默认生成的为："),a("code",[t._v("id_rsa")])])])])]),t._v(" "),a("p",[t._v("若你的机器没有私钥，你可以手动生成一堆公钥私钥进行放置到服务器~/.ssh/目录下，参考命令：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#生成密钥对")]),t._v("\n$ ssh-keygen -t rsa\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将公钥加到`authorized_keys`文件")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" -d /root/.ssh "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" /root/.ssh "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" -f /root/.ssh/authorized_keys "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" /root/.ssh/authorized_keys "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /root/.ssh/id_rsa.pub "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" ~/.ssh/authorized_keys "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")]),t._v(" ~/.ssh/authorized_keys "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" ok\n")])])]),a("p",[t._v("新建执行用户示例：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/create_exec_user.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/exec_user_list.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"任务发布"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#任务发布"}},[t._v("#")]),t._v(" 任务发布")]),t._v(" "),a("blockquote",[a("p",[t._v("这部分主要介绍代码发布的配置和一些SQL相关配置(更新中)，任务发布后续将会支持更多业务模块，目前以任务发布和SQL优化审核相关的配置为主；")])]),t._v(" "),a("p",[a("strong",[t._v("操作教学视频")]),t._v("："),a("a",{attrs:{href:"https://www.bilibili.com/video/av53424572/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.bilibili.com/video/av53424572/"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("strong",[t._v("应用发布")])]),t._v(" "),a("blockquote",[a("p",[t._v("该模块是任务发布主要功能，预先配置你代码发布的相关信息，设定时间自动执行。")])]),t._v(" "),a("p",[t._v("例举例一个简单发布示例：")]),t._v(" "),a("blockquote",[a("p",[t._v("请选择你要发布的应用，具体配置参考【作业配置】-【应用配置】。发布权限关联代码仓库权限【作业配置】-【代码仓库】。")])]),t._v(" "),a("p",[a("strong",[t._v("创建应用发布")])]),t._v(" "),a("p",[t._v("点开"),a("code",[t._v("应用发布")])]),t._v(" "),a("ul",[a("li",[t._v("选择应用：下拉选择在作业配置中配置的应用配置")]),t._v(" "),a("li",[t._v("标签版本：输入你的TAG")]),t._v(" "),a("li",[t._v("自定义参数：前面定义参数，后面填写对应值(例如：[IP] [203.167.11.100] )")]),t._v(" "),a("li",[t._v("开始时间：选择一个执行时间，来触发模板中的定时触发器")]),t._v(" "),a("li",[t._v("备注详情：填写你发布应用的标识")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/app_publish_1.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("SQL审核")])]),t._v(" "),a("blockquote",[a("p",[t._v("该模块用来将要执行的SQl语句的提交给审批人进行审批，审批通过后才会在指定时间执行该SQL语句")])]),t._v(" "),a("p",[a("strong",[t._v("注意")])]),t._v(" "),a("ul",[a("li",[t._v("1.当前页面使用标签关联相关数据库，选取标签下的mysql的写库")]),t._v(" "),a("li",[t._v("2.本服务多部署在内网，为了适配多云多区域，需要经过代理连接数据库，标签里面应配置代理主机，当前任务会跳转到代理主机执行数据库审核")]),t._v(" "),a("li",[t._v("3.请使用标准的SQL语句，从语句上选择数据库。")]),t._v(" "),a("li",[t._v("4.使用内建模板ID：9001主机组为1在没有熟悉模板的使用之前，不要随意更改相关任务模板")])]),t._v(" "),a("p",[t._v("点开"),a("code",[t._v("SQL审核")])]),t._v(" "),a("ul",[a("li",[t._v("目标标签：下拉选择你要关联的标签组")]),t._v(" "),a("li",[t._v("SQL语句：填写要执行的SQL语句")]),t._v(" "),a("li",[t._v("审批人员：下拉选择你要提交审核的用户")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/sql_auth.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("SQL优化")])]),t._v(" "),a("blockquote",[a("p",[t._v("该模块用于优化SQL语句，输入要执行的SQL语句然后进行平分和优化等操作")])]),t._v(" "),a("p",[a("strong",[t._v("注意")])]),t._v(" "),a("ul",[a("li",[t._v("1.当前页面使用标签关联相关数据库，选取标签下的mysql,SQL优化使用内建模板ID：9901主机组为1，在没有熟悉模板的使用之前，不要随意更改相关任务模板")]),t._v(" "),a("li",[t._v("2.本服务多部署在内网，为了适配多云多区域，需要经过代理连接数据库，标签信息里面应配置代理主机，当前任务会跳转到代理主机执行")])]),t._v(" "),a("p",[t._v("点开"),a("code",[t._v("SQL优化")])]),t._v(" "),a("ul",[a("li",[t._v("目标标签：下拉选择你要关联的标签组(注意:目标库只能选择一个数据库)")]),t._v(" "),a("li",[t._v("数据库名：输入要操作的数据库名称")]),t._v(" "),a("li",[t._v("优化类型：选择优化类型"),a("code",[t._v("SOAR")]),t._v("或"),a("code",[t._v("SQLAdvisor")])]),t._v(" "),a("li",[t._v("SQL语句：填写要优化的SQL语句")]),t._v(" "),a("li",[t._v("操作： 选择你要操作的选项"),a("code",[t._v("SQL评分")]),t._v(","),a("code",[t._v("SQL指纹")]),t._v(","),a("code",[t._v("SQL美化")]),t._v(","),a("code",[t._v("语法检查")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"/sql_opti.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("资源申购")])]),t._v(" "),a("blockquote",[a("p",[t._v("该模块用于申购服务器，数据库，Redis，负载均衡等资源使用(更新中)")])]),t._v(" "),a("p",[a("strong",[t._v("节点添加")])]),t._v(" "),a("blockquote",[a("p",[t._v("用于横向扩展Kubernetes(K8S)节点(更新中)")])]),t._v(" "),a("p",[a("strong",[t._v("自定义任务")])]),t._v(" "),a("blockquote",[a("p",[t._v("该模块可以更灵活的添加自己要对服务器操作的任务模板")])]),t._v(" "),a("p",[a("strong",[t._v("注意")])]),t._v(" "),a("ul",[a("li",[t._v("1.当前页面使用标签关联相关主机，选取标签下的主机, 系统直连主机并发执行选择模板的任务，为了减轻任务压力，限制并发100以内")])]),t._v(" "),a("p",[t._v("点开"),a("code",[t._v("自定义任务")])]),t._v(" "),a("ul",[a("li",[t._v("目标标签：下拉选择自定义的标签组")]),t._v(" "),a("li",[t._v("选择模板：下拉选择自定义的模板")]),t._v(" "),a("li",[t._v("参数1：填写上传的参数和对应参数值(可增加和删除参数选项)")]),t._v(" "),a("li",[t._v("执行时间：选择一个执行时间，用来触发模板中的定时触发器")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/custom_task.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("自定义任务-代理")])]),t._v(" "),a("blockquote",[a("p",[t._v("该模块用于处理无法直连服务器需要通过代理连接来执行一些任务")])]),t._v(" "),a("p",[a("strong",[t._v("注意")])]),t._v(" "),a("ul",[a("li",[t._v("1.当前页面使用标签关联相关主机，选取标签下的主机,在代理主机上执行选择模板的任务，并把主机名，IP地址传给任务，任务本身通过ansible、saltsatck、多线程、多进程等方法来进行并发。参数IP：SERVER_IP,主机名：SERVER_HOST一般可以作为salt name。")])]),t._v(" "),a("p",[t._v("点开"),a("code",[t._v("自定义任务-代理")])]),t._v(" "),a("ul",[a("li",[t._v("目标标签：下拉选择自定义的标签组(注意：标签可以多选，但是代理主机有且仅有一个，不可多选)")]),t._v(" "),a("li",[t._v("选择模板：下拉选择自定义的模板")]),t._v(" "),a("li",[t._v("参数：填写上传的参数和对应参数值(可增加和删除参数选项)")]),t._v(" "),a("li",[t._v("执行时间：选择一个执行时间，用来触发模板中的定时触发")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/custom_task_proxy.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("自定义任务-JSON")])]),t._v(" "),a("blockquote",[a("p",[t._v("该模块提供了自定义JSON的方式更方便灵活的来进行自定义任务")])]),t._v(" "),a("p",[a("strong",[t._v("注意：参数详解")])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"task_name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"任务名称"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"submitter"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"提交人"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"temp_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"schedule"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ready"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"exec_time"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2018-11-27 14:09:50"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"associated_user"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"{'group-1': ['杨红飞']}\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"args"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"{'VERSION':'eeee', 'arg02': 'xxxx'}\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"details"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"这里是备注"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hosts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"{1: '127.0.0.1'}\"")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n")])])]),a("ul",[a("li",[t._v("1.task_name: 任务名字")]),t._v(" "),a("li",[t._v("2.submitter: 提交人")]),t._v(" "),a("li",[t._v("3.temp_id：模板ID，就是你上面创建模板时候生成的那个ID")]),t._v(" "),a("li",[t._v("4.schedule：这是状态，常用的有ready和new ready：表示不通过人工审核，只要到了执行时间直接执行任务new：表示需要任何审核，管理员审核，选择执行时间，到时间后开始执行")]),t._v(" "),a("li",[t._v("5.exec_time： 任务执行时间，状态为ready的情况下，到这个时间会进行执行")]),t._v(" "),a("li",[t._v("6.args：这里是一个字典，里面的参数可以自行定义，如上，你模板参数里面用到了哪些你都可以在这里定义出来，当你的POST到这个接口时候，我们会自动接受此参数，并帮你运行脚本 解析你要传入的参数。")]),t._v(" "),a("li",[t._v("7.details：描述，备注信息")]),t._v(" "),a("li",[t._v("8.hosts：这个是执行主机，字典形式， 1表示第一组主机，也就是上面模板里面的组1，任务支持多组。主机IP，这个是执行主机，这个废话多一点，比如我以上模板的脚本在172.16.0.101这台主机上，我就想平台登陆我这个主机，来帮我执行这些脚本，至于怎么登陆，那么就是我最开始在平台里面配置了一个执行用户，我将我这个主机的私钥放到了平台上，公钥在我服务器上，这样子CODO平台就可以ssh -i xxxx.pem@{ip_address}远程到我的主机上帮我执行命令。")])]),t._v(" "),a("p",[t._v("点开"),a("code",[t._v("自定义任务-JSON")])]),t._v(" "),a("ul",[a("li",[t._v("POST JSON：输入你的数据，参考上面的示例，你也可以二次开发对接自己的CMDB获取主机，时间字段从下面获取，方便处理(注意：提交的数据必须以JSON格式，请严格按照说明提交)")]),t._v(" "),a("li",[t._v("执行时间：选择一个执行时间，用来触发模板中的定时触发")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/custom_task_json.png",alt:""}})]),t._v(" "),a("p",[t._v("PS：已经文档会在后续过程中不断更新完善，感谢大家支持。")]),t._v(" "),a("h2",{attrs:{id:"定时任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定时任务"}},[t._v("#")]),t._v(" 定时任务")]),t._v(" "),a("blockquote",[a("p",[t._v("通过定时任务可以进行添加你的定时任务")])]),t._v(" "),a("p",[a("strong",[t._v("定时任务特点")])]),t._v(" "),a("ul",[a("li",[t._v("restful api 简单易定制")]),t._v(" "),a("li",[t._v("可接入可视化界面操作")]),t._v(" "),a("li",[t._v("定时任务统一管理")]),t._v(" "),a("li",[t._v("完全兼容 crontab")]),t._v(" "),a("li",[t._v("支持秒级定时任务")]),t._v(" "),a("li",[t._v("任务可搜索、暂停、编辑、删除")])]),t._v(" "),a("p",[a("strong",[t._v("用户使用说明")])]),t._v(" "),a("ul",[a("li",[t._v("新增任务\n"),a("ul",[a("li",[t._v("job_id： 任务名称，建议为有意义的英文名称")]),t._v(" "),a("li",[t._v("可执行命令： "),a("code",[t._v("Linux Bash")]),t._v(" 命令，亦可将可执行程序放入指定的目录（使用docker 切记安装依赖）")]),t._v(" "),a("li",[t._v("任务定时器： （秒、分、时、日、月、周）\n"),a("ul",[a("li",[t._v("示例：每分钟的第20秒开始执行"),a("code",[t._v("pwd")]),t._v("命令")])])])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"/timed_task01.png",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("编辑任务")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/timed_task02.png",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("暂停恢复\n"),a("ul",[a("li",[t._v("状态栏可以将任务暂停/恢复")])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"/timed_task03.jpg",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("任务日志\n"),a("ul",[a("li",[t._v("每条任务执行都会记录日志")]),t._v(" "),a("li",[t._v("日志可根据Job_id、状态、关键字、时间范围等搜索")])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"/timed_logs.jpg",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"代码仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代码仓库"}},[t._v("#")]),t._v(" 代码仓库")]),t._v(" "),a("blockquote",[a("p",[t._v("列举一个平台上代码仓库部分的示例，让大家快速灵活的使用OpenDevOps平台，进行对接代码仓库的实战操作；")])]),t._v(" "),a("p",[a("strong",[t._v("创建代码仓库")])]),t._v(" "),a("p",[t._v("点开"),a("code",[t._v("作业配置")]),t._v("-"),a("code",[t._v("代码仓库")]),t._v("-"),a("code",[t._v("GIT配置")])]),t._v(" "),a("p",[a("strong",[t._v("填写对应git_url、"),a("a",{attrs:{href:"https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("private_token"),a("OutboundLink")],1),t._v("、deploy_key")])]),t._v(" "),a("ul",[a("li",[t._v("git_url： https://gitlab.domain.com/")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("private_token"),a("OutboundLink")],1),t._v(": Gitlab申请的Access Token")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/create_git01.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190705172432.png",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("添加保存后点击刷新地址，将同步所有该地址下的项目分支到平台")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/create_git03.png",alt:""}})]),t._v(" "),a("p",[t._v("至此，Gitlab的仓库信息已经可以同步到平台上了，如果你需要基于Gitlab 钩子进行操作，你需要进行以下配置")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("Git服务器操作--\x3e配置GitLab全局钩子")])]),t._v(" "),a("li",[a("strong",[t._v("CODO平台操作---\x3e配置单个仓库钩子匹配规则")])])]),t._v(" "),a("p",[a("strong",[t._v("第一步、配置Gitlab全局钩子")])]),t._v(" "),a("blockquote",[a("p",[t._v("此步骤是监控GitLab所有提交事件，根据平台配置的钩子匹配规则进行触发你所定义的任务")])]),t._v(" "),a("p",[t._v("注意："),a("code",[t._v("由于Gitlab版本存在CE版本和源码安装版本，全局update钩子配置不同")])]),t._v(" "),a("ul",[a("li",[t._v("GitlabCE版本路径："),a("code",[t._v("/opt/gitlab/embedded/service/gitlab-shell/hooks")])]),t._v(" "),a("li",[t._v("GitLab源码版本路径："),a("code",[t._v("/home/git/gitlab-shell/hooks/")])])]),t._v(" "),a("p",[t._v("此目录下的钩子都是为全局钩子，请慎重修改，本操作是不影响其余钩子/局部钩子的情况下添加的。")]),t._v(" "),a("p",[t._v("请修改"),a("code",[t._v("update")]),t._v("文件，在"),a("code",[t._v("ruby")]),t._v("脚本中修改成以下内容：")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/opt/gitlab/embedded/bin/ruby --disable-gems")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Fix the PATH so that gitlab-shell can find git-upload-pack and friends.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENV")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PATH'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/opt/gitlab/bin:/opt/gitlab/embedded/bin:'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENV")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PATH'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/usr/bin/env ruby")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# This file was placed here by GitLab. It makes sure that your pushed commits")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# will be processed properly.")]),t._v("\n\nref_name  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ARGV")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nold_value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ARGV")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nnew_value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ARGV")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nrepo_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Dir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pwd\nkey_id    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENV")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("delete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GL_ID'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#CODO TASK，只需要加下面2行即可")]),t._v("\ncodo_task_script "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/opt/codo/codo-scripts/gitlab/codo_task.py'")]),t._v("\nsystem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("codo_task_script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ref_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" old_value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" new_value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nrequire_relative "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../lib/gitlab_custom_hook'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GitlabCustomHook")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("repo_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ref_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" old_value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" new_value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  exit "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n  exit "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n")])])]),a("p",[t._v("示例图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190705174524.png",alt:""}})]),t._v(" "),a("p",[a("code",[t._v("/opt/codo/codo-scripts/gitlab/codo_task.py")]),t._v("脚本内容")]),t._v(" "),a("p",[t._v("注意： 一定要修改脚本中"),a("code",[t._v("accept_task_url")]),t._v(" 、"),a("code",[t._v("git_url")]),t._v("、"),a("code",[t._v("auth_key")]),t._v("内容")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/usr/bin/env python")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -*- coding: utf-8 -*-")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# @Time    : 2019/6/27 13:48")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# @Author  : Fred Yangxiaofei")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# @File    : codo_task.py")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# @Role    : GitLab全局Hooks  update钩子")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sys\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" os\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" requests\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" json\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("post_codo_task")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n    监控全局钩子，CODO提交任务\n    注意，Gitlab全局钩子调用此脚本的时候不能使用format\n    :return:\n    """')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改你的钩子任务API接口")]),t._v("\n    accept_task_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://codo.opendevops.com/api/task/other/v1/git/hooks/'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改你的GIT地址")]),t._v("\n    git_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://gitlab.domain.com/'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改你的长期Token，从管理员获取， 此用户的Token需要对/task/other/v1/git/hooks/接口有权限")]),t._v("\n    auth_key "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eyJ0eXAiOiJeHAiOjE2NTY1NzgwOTUsIm5iZiI6MTU1Mjg5ODA3Nh"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        tag_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tag/branch 名字")]),t._v("\n        repo_group "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("getcwd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 组名字")]),t._v("\n        repo_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("getcwd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("replace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.git'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# git名字")]),t._v("\n        relative_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" repo_group "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" repo_name  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 组+git名字路径")]),t._v("\n\n        the_body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dumps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git_url"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" git_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"relative_path"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" relative_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tag_name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tag_name\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        req1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("accept_task_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cookies"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("dict")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("auth_key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("auth_key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        csrf_key "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loads"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'csrf_key'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        cookies "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("dict")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("auth_key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("auth_key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" csrf_key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("csrf_key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        req "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("post"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("accept_task_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("the_body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cookies"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("cookies"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        req_dict "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loads"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hooks Log: '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req_dict"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'msg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),t._v(" Exception "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    post_codo_task"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),a("p",[a("strong",[t._v("第二步、CODO平台配置钩子规则")])]),t._v(" "),a("blockquote",[a("p",[t._v("针对单个项目进行配置钩子规则，当你打Tag/brach中提交的的时候，根据你的匹配规则，正则匹配、来触发你所定义的任务")])]),t._v(" "),a("ul",[a("li",[t._v("选择其中一个项目，点击对应的编辑按钮")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/create_git_hook01.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/create_git_hook02.png",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("提交测试钩子会在订单中心生成一个新订单，说明平台通道已经配置好")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/create_git_hook03.png",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("根据不同版本的gitlab有不同配置方式，老版本的gitlab由于API不完善，可以单独进行添加")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/create_git04.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/create_git05.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/create_git_hook02.png",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("都配置好之后可以自己打一个测试的tag进行测试")])]),t._v(" "),a("p",[t._v("示例命令：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#基于branch")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" --all\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" push -u origin master\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#基于tag")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" tag release-ftqqminigame-test01\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" push -u origin release-ftqqminigame-test01\n\n")])])]),a("p",[a("strong",[t._v("平台查看钩子日志")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190705175739.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("注意")])]),t._v(" "),a("ul",[a("li",[t._v("填写的git仓库域名地址和对应参数必须真实有效，否则测试不通过将不会保存")])]),t._v(" "),a("h2",{attrs:{id:"监控告警"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监控告警"}},[t._v("#")]),t._v(" 监控告警")]),t._v(" "),a("blockquote",[a("p",[t._v("监控报警主要分为2部分，ZABBIX+Prometheus 都是基于Webhook做的")])]),t._v(" "),a("p",[a("strong",[t._v("ZABBIX")])]),t._v(" "),a("p",[t._v("本章主要介绍下CODO中的ZABBIX怎么使用，他能帮你做什么？")]),t._v(" "),a("p",[a("strong",[t._v("功能简介")])]),t._v(" "),a("ul",[a("li",[t._v("支持多ZABBIX配置")]),t._v(" "),a("li",[t._v("支持多ZABBIX webhooks同时接入")]),t._v(" "),a("li",[t._v("支持多ZABBIX webhook告警日志展示")]),t._v(" "),a("li",[t._v("支持多ZABBIX 配置钩子实现故障自愈、自定义任务等")]),t._v(" "),a("li",[t._v("获取多ZABBIX Last Issues统一展示，不再多个系统之间奔波")])]),t._v(" "),a("p",[a("strong",[t._v("首先，点击ZABBIX配置，配置你的地址")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190718170416.png",alt:""}}),t._v(" "),a("strong",[t._v("刷新地址，将已配置的ZABBIX组/主机Hostname拉取下来")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190718175252.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("回到首页，你可以看到你多个ZABBIX Last Issues都统一展示出来了")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190718175435.png",alt:""}})]),t._v(" "),a("p",[t._v("至此，到这一步，已经将ZABBIX的信息给获取下来了, 并且可以看到  Last ISSUES了")]),t._v(" "),a("p",[t._v("But，你如果觉得这些还不够，接下来想要对报警进行下一步的操作，比如我要"),a("code",[t._v("故障自愈")]),t._v("，那么你就要开始用钩子功能了")]),t._v(" "),a("p",[t._v("这部分的逻辑是"),a("code",[t._v("配置权限")]),t._v("---\x3e"),a("code",[t._v("配置ZABBIX webhook")]),t._v("---\x3e"),a("code",[t._v("配置钩子")]),t._v("----\x3e"),a("code",[t._v("根据告警tagger_name匹配")]),t._v("---\x3e"),a("code",[t._v("故障自愈/自定义任务等操作")])]),t._v(" "),a("p",[t._v("那么，让我们开始吧。")]),t._v(" "),a("p",[a("strong",[t._v("配置权限")])]),t._v(" "),a("ul",[a("li",[t._v("权限配置用于向平台提交任务的权限，需要用户输入对应的API接口和Auth_key")]),t._v(" "),a("li",[t._v("auth_key：是管理员生成的长期Token")]),t._v(" "),a("li",[t._v("task_url：https://codo-v1.domain.com/api/task/v2/task/accept/")])]),t._v(" "),a("p",[t._v("测试保存，这里会进行权限认证，只有通过了认证才能保存成功。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190718175850.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("配置钩子")])]),t._v(" "),a("p",[t._v("选择一台机器，进行配置钩子")]),t._v(" "),a("p",[t._v("新建一个钩子， 这里可以配置多个 那么这里是怎么匹配的呢？ 简单记录下。")]),t._v(" "),a("ul",[a("li",[t._v("收到告警后，开始根据告警的ZABBIX地址+ZABBIX 主机查询 这个主机有配置钩子")]),t._v(" "),a("li",[t._v("如果有钩子规则，开始全匹配告警的tagger_name和你配置的tagger_name是不是一致的，一致的之间触发任务")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190719095329.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("测试钩子")])]),t._v(" "),a("ul",[a("li",[t._v("模拟ZABBIX告警信息来测试告警是否匹配，从而触发钩子任务")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190719095734.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190719095806.png",alt:""}})]),t._v(" "),a("p",[t._v("从上图可以看到，正常匹配到了，触发了任务， 数据也传了过来，接下来了有数据，用户可以实现自己的逻辑了。")]),t._v(" "),a("p",[t._v("那么如果告警没匹配怎么办， 我们来测试下")]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190719095806.png",alt:""}})]),t._v(" "),a("p",[t._v("可以看到，他会给我说匹配不到钩子")]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190719100136.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("钩子日志")])]),t._v(" "),a("p",[t._v("我们通过刚来的测试看下钩子日志")]),t._v(" "),a("ul",[a("li",[t._v("匹配到的会记录下来，并打出来执行的模板等信息")]),t._v(" "),a("li",[t._v("接收到的告警，没匹配也会记录下来，但是不做任何操作")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190719100312.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("ZABBIX webhook")])]),t._v(" "),a("p",[t._v("到了这一步，我们都是平台配置和测试，那么如果想要接入ZABBIX告警信息，就必须要借助的ZABBIX 的webhook功能")]),t._v(" "),a("p",[t._v("这里我们接着操作，接入ZABBIX，实现全局监控ZABBIX告警，自动触发，故障自愈，自定义任务等操作")]),t._v(" "),a("p",[t._v("ZABBIX的版本迭代也是蛮快的，为了更好的让用户使用，不同的版本我写了不同的适配脚本来实现， 差别不大")]),t._v(" "),a("p",[t._v("谈一下ZABBIX配置， 这里只要是配置一个ZABBIX mediatype，和 Action触发器，将告警信息发到我的接口里面，我来帮你分析")]),t._v(" "),a("p",[a("strong",[t._v("先来讲一下ZABBIX2.0")])]),t._v(" "),a("p",[t._v("ZABBIX 2.0 的版本是不支持mediaType里面传参的，但是他有三个默认参数，$3是邮件内容 $2 邮件标题 $1 发送给谁")]),t._v(" "),a("p",[t._v("既然他不支持自定义参数，那我们就借助他的默认参数，这里我用到了$2 第二个标题参数")]),t._v(" "),a("p",[a("strong",[t._v("先将脚本放到服务器上")])]),t._v(" "),a("p",[t._v("脚本放在那？  这个要看你配置在那里了，不管是Mail\\SMS\\Webhooks  只要是触发脚本类型的都在这里")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#让我们查一下你的配置是什么？")]),t._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" -r "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AlertScriptsPath"')]),t._v(" /etc/zabbix/zabbix_server.conf\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("AlertScriptsPath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/lib/zabbix/alertscripts   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#脚本就放在这里")]),t._v("\n\n")])])]),a("p",[t._v("ZABBIX2.0版本")]),t._v(" "),a("p",[t._v("官方示例脚本：")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/usr/bin/env python")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -*- coding: utf-8 -*-")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# @Time    : 2019/7/10 10:09")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# @Author  : Fred Yangxiaofei")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# @File    : send_alert.py")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# @Role    : Zabbix webhooks 发送告警信息测试")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# zabbix3.0+配置")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sys\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" requests\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" json\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send_alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zabbix_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" webhook_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" messages"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里就是一个长期Token，管理员可以在用户列表选择一个用户进行生成一个长期Token， 但是需要对/tools/v1/zabbix/hooks/接口有权限")]),t._v("\n    params "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"auth_key"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eyJ0eXAiOiJKV1QiLCJhbGciSmW4m45L4w5XjDHPU3yBIzU0gfWeKnLH3SV4gFPLN6g"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# payload = "{\\"data\\": \\"test\\"}"')]),t._v("\n    payload "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"zabbix_url"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" zabbix_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"messages"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" messages"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    headers "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'content-type'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cache-control'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"no-cache"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    response "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("post"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("webhook_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dumps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 你的ZABBIX地址,高版本ZABBIX你也可以从ZABBIX配置中传过来,请确保你和CODO平台上配置的一模一样")]),t._v("\n    zabbix_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://zabbixdoamin.com/zabbix'")]),t._v("\n\n    webhook_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://codo.domain.com/api/tools/v1/zabbix/hooks/'")]),t._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ZABBIX的告警信息，这个我要用到，所以就要强规范：{HOSTNAME}___{HOST.IP}___{TRIGGER.NAME}___{TRIGGER.STATUS}___{TRIGGER.SEVERITY}")]),t._v("\n    messages "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n    send_alert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zabbix_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" webhook_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" messages"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n如何使用：\n\npip install json\npip install requests\n\n如何测试：\n\npython send_alert_to_codo.py \'\' \'Zabbix server___127.0.0.1___Zabbix agent on Zabbix server is unreachable for 5 minutes___PROBLEM___Average\'\n"""')]),t._v("\n\n\n")])])]),a("p",[a("strong",[t._v("配置好了脚本，我们来配置2版本的ZABBIX")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190719101037.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("配置一个Action")])]),t._v(" "),a("p",[t._v("这里为了不影响你现有的，我们之间配置一个新的")]),t._v(" "),a("p",[t._v("但是这里切记标题是强规范，将我的标题给复制进去，其余的不重要")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("\n{HOSTNAME}___{HOST.IP}___{TRIGGER.NAME}___{TRIGGER.STATUS}___{TRIGGER.SEVERITY}\n\n")])])]),a("p",[a("img",{attrs:{src:"/20190719101654.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190719101829.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190719101943.png",alt:""}})]),t._v(" "),a("p",[t._v("以上，是ZABBIX 2.0版本的配置")]),t._v(" "),a("p",[a("strong",[t._v("ZABBIX3.0配置webhook")])]),t._v(" "),a("p",[t._v("现在相信很多人也都用了最新的ZABBIX，那么我们必然也要支持以下了，ZABBIX 3.0+就支持自定义传参了，这个还是挺人性化的， ZABBIX3.0和2.0的配置思路一样，接下来让我们开始吧。")]),t._v(" "),a("p",[a("strong",[t._v("先将脚本放到服务器上")])]),t._v(" "),a("p",[t._v("脚本放在那？  这个要看你配置在那里了，不管是Mail\\SMS\\Webhooks  只要是触发脚本类型的都在这里")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#让我们查一下你的配置是什么？")]),t._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" -r "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AlertScriptsPath"')]),t._v(" /etc/zabbix/zabbix_server.conf\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("AlertScriptsPath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/lib/zabbix/alertscripts   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#脚本就放在这里")]),t._v("\n\n")])])]),a("p",[t._v("ZABBIX3.0版本")]),t._v(" "),a("p",[t._v("官方示例脚本：")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/usr/bin/env python")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -*- coding: utf-8 -*-")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# @Time    : 2019/7/10 10:09")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# @Author  : Fred Yangxiaofei")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# @File    : send_alert.py")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# @Role    : Zabbix webhooks 发送告警信息")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# zabbix3.0+配置")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sys\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" requests\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" json\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send_alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zabbix_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" webhook_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" messages"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里就是一个长期Token，管理员可以在用户列表选择一个用户进行生成一个长期Token， 但是需要对/tools/v1/zabbix/hooks/接口有权限")]),t._v("\n    params "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"auth_key"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eyJ0eXAiOiJKV1QiLCJ.SmW4m45L4w5XjDHPU3yBIzU0gfWeKnLH3SV4gFPLN6g"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# payload = "{\\"data\\": \\"test\\"}"')]),t._v("\n    payload "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"zabbix_url"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" zabbix_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"messages"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" messages"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    headers "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'content-type'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cache-control'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"no-cache"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    response "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("post"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("webhook_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dumps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    zabbix_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://xxxxx/zabbix'")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 你的ZABBIX地址,高版本ZABBIX你也可以从ZABBIX配置中传过来")]),t._v("\n    webhook_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    messages "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n    send_alert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zabbix_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" webhook_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" messages"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n如何使用：\n\npip install json\npip install requests\n\n如何测试：\n\npython send_alert_to_codo.py https://codo.domain.com/api/tools/v1/zabbix/hooks/ alert_message_test\n"""')]),t._v("\n\n")])])]),a("p",[t._v("ZABBIX3.0配置")]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190719101943.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190719102304.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("配置一个Action")])]),t._v(" "),a("p",[t._v("这里为了不影响你现有的，我们之间配置一个新的")]),t._v(" "),a("p",[t._v("但是这里切记标题是强规范，将我的标题给复制进去，其余的不重要")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("\n{HOSTNAME}___{HOST.IP}___{TRIGGER.NAME}___{TRIGGER.STATUS}___{TRIGGER.SEVERITY}\n\n")])])]),a("p",[a("img",{attrs:{src:"/20190719102659.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190719102808.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/20190719102916.png",alt:""}})]),t._v(" "),a("p",[t._v("接下来就完成了，你可以触发一个告警，进行测试了。")]),t._v(" "),a("h2",{attrs:{id:"资产管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#资产管理"}},[t._v("#")]),t._v(" 资产管理")]),t._v(" "),a("blockquote",[a("p",[t._v("这部分主要介绍CMDB资产管理一期，更多新功能正在开发中，现版本详细操作也可观看"),a("a",{attrs:{href:"https://www.bilibili.com/video/av53408299/",target:"_blank",rel:"noopener noreferrer"}},[t._v("视频示例"),a("OutboundLink")],1)])]),t._v(" "),a("p",[a("strong",[t._v("添加主机")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("管理用户： 例如AWS的"),a("code",[t._v("ec2-user")])])]),t._v(" "),a("li",[a("p",[t._v("其余字段不做多解释，从字面可以看出意思")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"/cmdh_add_host.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("资产更新")])]),t._v(" "),a("p",[t._v("选择主机进行资产更新，这里为手动更新，默认系统会每天进行后台自动更新")]),t._v(" "),a("p",[a("img",{attrs:{src:"/cmdb_asset_update.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/asset_server_detail.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("同步标签树")])]),t._v(" "),a("p",[t._v("不需要选中主机，同步标签树是一个和作业配置中标签树进行了打通，如果需要CMDB的数据同步到标签树里面则点击此按钮即可同步，同步后数据以CMDB为主，标签树里面多出来的则会被删除，谨慎操作。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/cmdb_sync_tag.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("机器状态")])]),t._v(" "),a("p",[t._v("CMDB中的几种状态")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("New：表示手动新增的机器")])]),t._v(" "),a("li",[a("p",[t._v("Auto：表示自动从云厂商拉取过来的主机，这个时候主机详情的信息都是云上获取到的一些基础信息")])]),t._v(" "),a("li",[a("p",[t._v("True：表示已经手动点了资产更新的操作，这时候资产信息都是从主机系统上脚本获取到的信息")])]),t._v(" "),a("li",[a("p",[t._v("False：表示更新资产失败，这个状态下是可以查看错误日志的")])])]),t._v(" "),a("p",[a("strong",[t._v("DB管理")])]),t._v(" "),a("p",[t._v("这里DB管理第一版只是简单的记录，没有规划很多功能，很多字段也是预留字段，后续会做成自动相关的")]),t._v(" "),a("p",[a("img",{attrs:{src:"/asset_db.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("标签管理")])]),t._v(" "),a("p",[t._v("取消了组的概念，Tag设计的出发点就是伪组，这里也是将机器分类")]),t._v(" "),a("p",[a("img",{attrs:{src:"/asset_tag.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("管理用户")])]),t._v(" "),a("ul",[a("li",[t._v("将私钥放在平台上，平台是根据这个私钥去连接你的主机的，例如：AWS的"),a("code",[t._v("ec2-user")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"/asset_admin_user.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("资产配置")])]),t._v(" "),a("p",[t._v("这一块主要用来用户给我配置一些Key信息，我去APi接口里面把机器给获取下来加到CMDB里面")]),t._v(" "),a("p",[t._v("自动拉取，后端日志统一在："),a("code",[t._v("tailf /var/log/supervisor/cmdb_cron.log")])]),t._v(" "),a("ul",[a("li",[t._v("只有状态按钮为开启状态，系统才会去你配置的区域里面去拉取主机信息")]),t._v(" "),a("li",[t._v("请确保你填写的AccessID/AccessKey/Region区域信息的准确性，可点击测试按钮进行测试权限")]),t._v(" "),a("li",[t._v("最好能够确保你机器的Hostname是唯一值，CMDB设计中Hostname是不允许重复的，自动必然要有一些规范")]),t._v(" "),a("li",[t._v("默认管理用户：此用户是可以登陆机器的，若此处填写了默认管理用户，会自动给机器关联上此用户，用于后续资产更新连接使用，一般情况下管理用户一个账户里面OPS都是1-2个，毕竟太多OPS自己维护起来也很麻烦")]),t._v(" "),a("li",[t._v("自动获取来的机器状态都是Auto状态，若不配置管理用户，默认资产详情信息都是从云平台获取的一些基本信息，若配置了管理用户并更新了资产，资产信息来源基于系统本身获取到的")]),t._v(" "),a("li",[a("code",[t._v("拉取资产按钮：手动触发云厂商主机更新到主机列表，默认情况下6小时会自动更新一次，请不要频繁点击，可能会产生调用接口费用(AWS)")])]),t._v(" "),a("li",[t._v("若此处配置了，系统会自动调用请求云厂商主机详情脚本(只要有查询实例的权限即可)，将指定区域的配置自动拉取并写入CMDB中,另外AWS测试可能需要5~10s不等，因为请求接口都在国外")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/asset_config.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"配置中心"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置中心"}},[t._v("#")]),t._v(" 配置中心")]),t._v(" "),a("blockquote",[a("p",[t._v("这部分主要介绍下配置中心使用说明")])]),t._v(" "),a("p",[a("strong",[t._v("新建项目")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/configuration_center01.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("填写环境-服务等信息")]),t._v(" "),a("img",{attrs:{src:"/configuration_center02.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("对项目授权")])]),t._v(" "),a("p",[t._v("对整个项目授权是可以看到整个项目里面的配置")]),t._v(" "),a("p",[a("img",{attrs:{src:"/configuration_center03.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("对单个环境授权")])]),t._v(" "),a("p",[t._v("对单个环境授权：项目下若有多个环境，授权的用户只能看到指定的环境")]),t._v(" "),a("p",[a("img",{attrs:{src:"/configuration_center04.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("如何获取配置")])]),t._v(" "),a("blockquote",[a("p",[t._v("那么我新建了一个配置，我怎么获取到他呢？ 没关系我们提供了获取配置的示例")])]),t._v(" "),a("ul",[a("li",[t._v("简单示例，也可"),a("a",{attrs:{href:"https://github.com/opendevops-cn/kerrigan/blob/master/libs/get_config.py",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考复杂示例"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("Python版本")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/usr/bin/env python ")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -*-coding:utf-8-*- ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" os \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" requests \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" json \n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConfApi")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("__init__")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# self.auth_key 是一个长期Token，基于用户管理里面，管理员选中用户生成长期Token，默认发送到用户邮箱")]),t._v("\n        self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth_key "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eyJ0eXAiOiJKV1QiLCJhbmZpZyIsIm5pY2XcFBbGciOiJIUzI1NiJ9.eyJleHAiOjE2NTMwMzQyNzYsIm5iZiI6MTU1Nzk5NDI1NiwiaWF0IjoxNTU3OTk0Mj3ZjZlXHU3NTI4XHU2MjM3IY2LCJpc3MiOiJhdXRoOiBzcyIsInQiOiIxNTYxODcxODA2MCIsImRhdGEiOnsidXNlcl9pZCI6NjYsInVzZXJuYW1lIjoiZ2V0X2NvFOOo'")]),t._v("\n        self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/tmp'")]),t._v("\n        self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf_config_api "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://codo.domain.com/api/kerrigan/v1/conf/publish/config/"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置中心获取API")]),t._v("\n\n\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_config_details")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" project_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" environment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取配置文件内容,  2019-04-28支持URL auth_key登陆，不需要再登陆进行获取auth_key，直接生成长期Token用")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#__token = self.login()")]),t._v("\n\n        __token "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth_key\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            _params "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'project_code'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" project_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'environment'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" environment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'service'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'filename'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'auth_key'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" __token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            res "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf_config_api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            ret "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loads"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'code'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),t._v(" Exception "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[Error:] 发布配置接口连接失败，错误信息：{}'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            exit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_config_file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" project_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" environment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生成配置文件")]),t._v("\n        config_data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_config_details"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("project_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" environment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("v "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" config_data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            config_file "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" k\n            dir_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exists"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dir_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("makedirs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dir_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config_file "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'w'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     print('config file path is {}'.format(config_file))")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# print('success')")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" config_file  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#返回文件路径")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    obj "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ConfApi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    config_file "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("create_config_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DNS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'release'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dnsmasq'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dnsmasq.conf'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    hosts_config_file "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("create_config_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DNS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'release'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dnsmasq'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dnsmasq_hosts'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),a("p",[t._v("Go版本")]),t._v(" "),a("p",[a("code",[t._v("go run write_conf.go -p code-v1 -e dev -s codo-admin -f settings.py -r /tmp/settings.py1")])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用golang编写，可以应付多种环境，并且可以对文件编译，防止密钥泄露")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"encoding/json"')]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"flag"')]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"io/ioutil"')]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"os"')]),t._v("\n\n "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/kirinlabs/HttpRequest"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n authKey "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eyJ0eXAiOiJKV1QiLCJ2MCIsImRhdGEiOnsidXNlcl9pZCI6MjgsInVzZXJuYW1lIjoic3MtdGVzdhbGciOiJIUzI1NiJ9.eyJleHAiOjE2NTQ4MjzdXBlcnVzZXIiOmZhbHNlfc2MDYsIm5iZiI6MTU1OTc4NzU4NiwiaWF0IjoxNTU5Nzg3NTk2LCJpc3MiOiJhdXRoOiBzcyIsInN1YiI6Im15IHRva2VuIiwiaWQiOiIxNTYxODcxODACIsIm5pY2tuYWJpc19X0.gMGMRKqtd_CM6rIzE8mxuwR8c8dz_hyH21FETOO4XbE"')]),t._v("\n confURL "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://codo.domain.com/api/kerrigan/v1/conf/publish/config/"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n project_code "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n environment  "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n service      "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n filename     "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n realfilename "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n configData   "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getArgs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n flag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("StringVar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("project_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"p"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ss"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"项目代号"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n flag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("StringVar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("environment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"e"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dev"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"环境"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n flag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("StringVar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"应用名称"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n flag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("StringVar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"f"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"settings.py"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"文件名"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n flag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("StringVar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("realfilename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"r"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/tmp/settings.py"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"最终写入文件"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n flag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Parse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" project_code "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ss"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[Error] 参数不正确，请使用参数 --help 查看帮助"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Exit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeWithIoutil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" content "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ioutil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("WriteFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0644")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[Success] 修改配置成功"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getArgs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n req "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" HttpRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置超时时间，不设置时，默认30s")]),t._v("\n req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置Headers")]),t._v("\n req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetHeaders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/x-www-form-urlencoded"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//这也是HttpRequest包的默认设置")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置Cookies")]),t._v("\n req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetCookies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"auth_key"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" authKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// GET")]),t._v("\n resp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("confURL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"project_code"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" project_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"environment"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  environment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"service"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("      service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"filename"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("     filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[Error]"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// log.Println(err)")]),t._v("\n  os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Exit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" resp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("StatusCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" resp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[Error]"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Exit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  res "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Unmarshal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("range")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   configData "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Sprintf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%v"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Exit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeWithIoutil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("realfilename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" configData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("h2",{attrs:{id:"用户管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用户管理"}},[t._v("#")]),t._v(" 用户管理")]),t._v(" "),a("blockquote",[a("p",[t._v("这部分文档主要用来介绍用户管理，它可以很精细的管理你的用户权限")])]),t._v(" "),a("p",[a("strong",[t._v("用户列表")])]),t._v(" "),a("p",[t._v("用户列表：顾名思义，用来管理和展示用户的列表，记录用户的详细信息")]),t._v(" "),a("p",[a("strong",[t._v("功能支持")])]),t._v(" "),a("ul",[a("li",[t._v("搜索用户")]),t._v(" "),a("li",[t._v("新建用户")]),t._v(" "),a("li",[t._v("删除用户")]),t._v(" "),a("li",[t._v("关闭用户")]),t._v(" "),a("li",[t._v("重置密码")]),t._v(" "),a("li",[t._v("重置MFA（Google Authenticator）")]),t._v(" "),a("li",[t._v("生成长期Token(管理员)")])]),t._v(" "),a("p",[a("strong",[t._v("展示界面")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/user_list.png",alt:"user_list"}})]),t._v(" "),a("p",[a("strong",[t._v("权限列表")])]),t._v(" "),a("p",[t._v("用来详细配置管理每个接口的权限，默认不需修改。")]),t._v(" "),a("p",[a("strong",[t._v("注意事项")])]),t._v(" "),a("ul",[a("li",[t._v("系统默认已经配置了所有权限和方法，管理员默认拥有"),a("code",[t._v("/")]),t._v("权限，无需修改，以免造成系统请求某功能出错")])]),t._v(" "),a("p",[a("strong",[t._v("功能说明")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("支持多种搜索方式，如：权限名称、请求路径、请求方法、时间等")])]),t._v(" "),a("li",[a("p",[t._v("支持新增、编辑、关闭、删除等操作权限的管理")])]),t._v(" "),a("li",[a("p",[t._v("支持新增自定义权限功能，适用于开发人员编写的API接口能很方便的接入进来权限管理划分")])]),t._v(" "),a("li",[a("p",[t._v("一些详细的API及使用文档正在支持更新中............")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"/permission_list.png",alt:"user_list"}})]),t._v(" "),a("p",[a("strong",[t._v("菜单组件")])]),t._v(" "),a("p",[t._v("菜单组件：顾名思义，也就是导航栏所看到的功能模块（如：用户管理、系统管理）和一些功能按钮（如：编辑、删除按钮），默认无需修改")]),t._v(" "),a("p",[a("strong",[t._v("注意事项")])]),t._v(" "),a("ul",[a("li",[t._v("系统默认已经配置了所有菜单功能模块及组件，无需修改此项，以免造成访问出错。")])]),t._v(" "),a("p",[a("strong",[t._v("功能介绍")])]),t._v(" "),a("p",[t._v("列举以下几个菜单和组件进行介绍，字面英语也可看出含义，如下：")]),t._v(" "),a("ul",[a("li",[t._v("home：家目录")]),t._v(" "),a("li",[t._v("usermanage：用户管理")]),t._v(" "),a("li",[t._v("cron：定时任务")]),t._v(" "),a("li",[t._v("edit_button：编辑按钮")])]),t._v(" "),a("p",[t._v("由于代码层面不好直接使用中文，你可以选择平台语言"),a("code",[t._v("English")]),t._v("，如下图，很清晰看到每个作用。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/menusv2.png",alt:"menus"}})]),t._v(" "),a("p",[a("strong",[t._v("角色管理")])]),t._v(" "),a("p",[t._v("基于"),a("a",{attrs:{href:"https://baike.baidu.com/item/RBAC/1328788?fr=aladdin",target:"_blank",rel:"noopener noreferrer"}},[t._v("RBAC"),a("OutboundLink")],1),t._v("角色管理访问控制权限，可以很精细/方便的管理你的用户权限")]),t._v(" "),a("p",[a("strong",[t._v("功能介绍")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("角色的搜索、编辑、关闭、删除")])]),t._v(" "),a("li",[a("p",[t._v("自定义角色名字，自定义赋权组件、菜单、权限管理")])]),t._v(" "),a("li",[a("p",[t._v("列表可搜索赋权设计，方便用户可视化操作")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"/rbac.png",alt:"rbac"}})]),t._v(" "),a("p",[a("strong",[t._v("示例介绍分为两部分，创建管理员用户赋权和创建普通用户赋权")])]),t._v(" "),a("p",[a("strong",[t._v("创建普通用户示例")])]),t._v(" "),a("p",[a("strong",[t._v("新建用户")])]),t._v(" "),a("p",[t._v("同上，填写信息即可，详细权限管理全部在角色管理配置")]),t._v(" "),a("p",[a("strong",[t._v("用户赋权")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/create_general_user.png",alt:"create_general_user"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/general_user_epmv2.png",alt:"general_user_epm"}})]),t._v(" "),a("p",[a("strong",[t._v("创建管理员用户示例")])]),t._v(" "),a("p",[a("strong",[t._v("新增用户")])]),t._v(" "),a("p",[t._v("点击用户列表---新增用户，输入信息")]),t._v(" "),a("p",[a("img",{attrs:{src:"/create_user.png",alt:"create_user"}})]),t._v(" "),a("p",[a("strong",[t._v("用户赋权")])]),t._v(" "),a("p",[t._v("点击角色管理---新建，输入角色信息，选择角色进行赋权")]),t._v(" "),a("p",[a("img",{attrs:{src:"/create_rbac.png",alt:"create_rbac"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/general_user_epmv2.png",alt:"user_emp"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/user_emp02.png",alt:"user_emp02"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/user_emp03.png",alt:"user_emp03"}})]),t._v(" "),a("p",[a("strong",[t._v("获取长期Token")])]),t._v(" "),a("blockquote",[a("p",[t._v("本系统使用token进行身份验证，当用户需要API进行访问的时候就需要获取token，并把token放入cookie里或者 访问的url参数里")])]),t._v(" "),a("ul",[a("li",[t._v("从用户管理 > 菜单组件里面找到 get_token_btn 这个代表获取token的按钮 要存在并且启用")]),t._v(" "),a("li",[t._v("从用户管理 >角色管理里面找到你要赋值的角色，点击组件把get_token_btn 添加进去")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/opendevops-cn/codo-admin/master/doc/images/tianjiazujian.png",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("从用户管理 > 用户列表 会看到这个长期token的按钮，如果你是超级管理员 你就可以选中用户点击，然后系统会通过邮件把这个用户的token 发送至当前用户以及被选中用户的邮箱，token 有效期为三年。强烈建议如果使用token进行操作的时候 使用单独用户，防止人员变动造成token不可用，要进行精确权限控制，做好备注，且不要给此用户菜单以及组件权限。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/opendevops-cn/codo-admin/master/doc/images/get_token.png",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("使用token 向 CODO 服务 API 提交安全的 REST 或 HTTP 查询协议请求。为了您的安全，请不要与任何人分享您的密钥。作为最佳做法，我们建议经常更换密钥")]),t._v(" "),a("li",[t._v("简单python示例，当然你之前一定会检查这个token是否对这个接口有权限，对吧！")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" requests\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" json\n\nauth_key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'这里就是你的token'")]),t._v("\nurl "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://xxx.xxxx.cn/api/kerrigan/v1/conf/publish/config/?project_code=shenshuo&environment=dev&service=nginx&filename=demo.conf'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### 使用 cookie 传递")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    res "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cookies"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("dict")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("auth_key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("auth_key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    ret "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loads"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'code'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),t._v(" Exception "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[Error:] 接口连接失败，错误信息：{}'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    exit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### 使用url 传递")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    _params "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'这里是参数名'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'这里是参数值'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'auth_key'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" auth_key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    res "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    ret "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loads"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'code'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),t._v(" Exception "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[Error:] 接口连接失败，错误信息：{}'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    exit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"系统管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统管理"}},[t._v("#")]),t._v(" 系统管理")]),t._v(" "),a("blockquote",[a("p",[t._v("这部分主要介绍系统配置，系统管理模块主要分为："),a("code",[t._v("系统配置")]),t._v("和"),a("code",[t._v("系统日志")])])]),t._v(" "),a("p",[a("strong",[t._v("系统配置")])]),t._v(" "),a("blockquote",[a("p",[t._v("系统配置主要介绍系统参数配置，后续后陆续支持各种核心功能配置")])]),t._v(" "),a("p",[a("strong",[t._v("系统配置")])]),t._v(" "),a("blockquote",[a("p",[t._v("这块需要配置你的API地址，部署时你API网关服务所部署的服务器地址，只有确认了API网关，各个功能模块才可以正常通信。")])]),t._v(" "),a("ul",[a("li",[t._v("API地址: 你的API网关地址，可以是IP/域名，必填项.")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/api_addressv2.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("邮件设置")])]),t._v(" "),a("blockquote",[a("p",[t._v("这块主要配置邮箱，配置了此邮箱信息后，后续平台内所涉及到邮件提醒都会使用此邮箱配置。")])]),t._v(" "),a("p",[t._v("不同运营商配置可参考"),a("code",[t._v("FAQ")]),t._v("中"),a("a",{attrs:{href:"https://docs.opendevops.cn/zh/guide/more/faq/",target:"_blank",rel:"noopener noreferrer"}},[t._v("邮箱设置问题"),a("OutboundLink")],1)]),t._v(" "),a("ul",[a("li",[t._v("SMTP主题： 邮件标题")]),t._v(" "),a("li",[t._v("SMTP主机： 服务器地址")]),t._v(" "),a("li",[t._v("SMTP端口： 服务器端口")]),t._v(" "),a("li",[t._v("SMTP账户： 邮箱账户名")]),t._v(" "),a("li",[t._v("SMTP密码： 邮箱账户密码")]),t._v(" "),a("li",[t._v("如果SMTP端口是465，通常需要启用SSL")]),t._v(" "),a("li",[t._v("如果SMTP端口是587，通常需要启用TLS")]),t._v(" "),a("li",[t._v("点击测试邮件会给当前用户发送一封邮件用于测试")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/system_email.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("短信接口")])]),t._v(" "),a("blockquote",[a("p",[t._v("这块主要配置短信接口信息，短信接口只支持阿里云"),a("code",[t._v("阿里大鱼")]),t._v("，后续平台所涉及到发短信会调用此接口")])]),t._v(" "),a("ul",[a("li",[t._v("短信区域： "),a("code",[t._v("cn-hangzhou")]),t._v(" 目前阿里官方给出必须是这个")]),t._v(" "),a("li",[t._v("API名称： "),a("code",[t._v("Dysmsapi")]),t._v(" 目前官方给出一般都是这个名称")]),t._v(" "),a("li",[t._v("API域名："),a("code",[t._v("dysmsapi.aliyuncs.com")]),t._v(" 目前官方给出必须是这个地址")]),t._v(" "),a("li",[t._v("KEY_ID： 你的IAM访问控制密钥ID")]),t._v(" "),a("li",[t._v("KEY_SECRET： 你的access_secret密钥，备注："),a("code",[t._v("这里需要必须有SMS的权限")])]),t._v(" "),a("li",[t._v("点击测试端口系统会向阿里大鱼进行发送查询接口，如果配置验证不通过则提示报错信息")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/system_smsv2.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("LDAP设置")])]),t._v(" "),a("blockquote",[a("p",[t._v("这块主要用于配置LDAP认证")])]),t._v(" "),a("p",[t._v("实例图如下：")]),t._v(" "),a("p",[t._v("​    "),a("img",{attrs:{src:"/ldap.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("邮箱登陆")])]),t._v(" "),a("blockquote",[a("p",[t._v("这块主要是支持第三方邮箱登陆，当你想要使用邮箱登陆此平台时，你可以在此进行配置\n比如我们企业邮箱是腾讯的,域名就是"),a("code",[t._v("opendevops.cn")]),t._v("，SMTP就是腾讯的"),a("code",[t._v("stmp.exmail.qq.com")]),t._v(",这样配置完成后我就可以使用我"),a("code",[t._v("yanghongfei@opendevops.cn")]),t._v("邮箱+密码登陆此平台了。")])]),t._v(" "),a("ul",[a("li",[t._v("邮箱SMTP： 这里输入你邮箱服务商的SMTP地址")]),t._v(" "),a("li",[t._v("邮箱域名：这里是你的邮箱后缀名字")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/system_email_loginv2.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("存储配置")])]),t._v(" "),a("blockquote",[a("p",[t._v("这块主要是配置Bucket信息，目前只支持阿里云的OSS，这里目前主要用于将跳板日志审计的内容存放到OSS目录里面，若不配置此项则存本地数据库（可能会很大，建议配置OSS)")])]),t._v(" "),a("ul",[a("li",[t._v("区域Region：阿里云的可用区域，如："),a("code",[t._v("cn-hangzhou")])]),t._v(" "),a("li",[t._v("存储桶名称: Bucket名称")]),t._v(" "),a("li",[t._v("SecretID: 密钥ID，需要有OSS权限")]),t._v(" "),a("li",[t._v("Secret Key： 密钥Key，需要有OSS权限")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/system_bucketv2.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("系统日志")])]),t._v(" "),a("blockquote",[a("p",[t._v("这里主要记录的本系统平台的所有请求日志，如：GET/POST/DELETE/PUT等，你的操作信息都会被记录，不要随意干坏事哟，管理员都可以看到的，安全我们还是会考虑进去的。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/system_log.png",alt:""}})]),t._v(" "),a("p",[t._v("最后，感谢你的支持，我们正在不断完善文档和平台功能，你也可以加入我们的的社区交流群进行反馈信息，给我们带来你的意见和建议。")])])}),[],!1,null,null,null);s.default=e.exports}}]);